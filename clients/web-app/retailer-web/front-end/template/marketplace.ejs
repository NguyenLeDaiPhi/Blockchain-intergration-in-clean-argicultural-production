<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title><%= pageTitle || "Marketplace" %></title>
  <link rel="stylesheet" href="/css/theme.css">
</head>
<body>

<div class="app">

  <!-- SIDEBAR -->
  <%- include("partials/sidebar", { user }) %>

  <!-- MAIN -->
  <div class="main">

    <!-- HEADER (C√ì SEARCH ‚Äì CH·ªà TRANG MARKETPLACE) -->
    <%- include("partials/header", { 
          pageTitle: pageTitle, 
          showSearch: true 
    }) %>

    <!-- CONTENT -->
    <main class="content">
      <div class="content-inner">

        <% if (!products || products.length === 0) { %>
          <p class="empty-text">Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o</p>
        <% } else { %>

        <div class="grid" id="productGrid">

          <% products.forEach(p => { %>
            <div class="product-card" data-name="<%= p.name.toLowerCase() %>">

              <!-- IMAGE -->
              <div class="product-image">
                <img src="/img/product-placeholder.png" alt="<%= p.name %>">
              </div>

              <!-- INFO -->
              <div class="product-info">
                <h3><%= p.name %></h3>
                <p class="farm">Farm ID: <%= p.farmId %></p>
                <p class="price"><%= p.price %> VND</p>
              </div>

              <!-- ACTION -->
              <div class="product-actions">
                <button class="btn-outline" onclick="openQr('<%= p.id %>')">
                   Xem chi ti·∫øt
                </button>
                  <button
                      class="btn-primary add-to-cart-btn"
                      data-id="<%= p.id %>"
                      data-name="<%= p.name %>"
                      data-price="<%= p.price %>"
                >
                  Th√™m v√†o gi·ªè
                </button>
              </div>

            </div>
          <% }) %>

        </div>
        <% } %>

      </div>
    </main>

    <!-- FOOTER -->
    <%- include("partials/footer") %>

  </div>
</div>

<!-- QR POPUP -->
<div class="qr-overlay" id="qrOverlay" onclick="closeQr()">
  <div class="qr-box" onclick="event.stopPropagation()">
    <div class="qr-placeholder">
      üì¶<br>
      ƒê√¢y l√† m√£ QR
    </div>
  </div>
</div>

<!-- JS -->
<script src="/js/layout.js"></script>
<script src="/js/marketplace-search.js"></script>
<script src="/js/cart.js"></script>


</body>
</html>
