<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title><%= pageTitle || "Chi ti·∫øt ƒë∆°n h√†ng" %></title>
  <link rel="stylesheet" href="/css/theme.css">
</head>
<body>

<div class="app">
  <%- include("partials/sidebar", { user }) %>

  <div class="main">
    <%- include("partials/header", { pageTitle }) %>

    <main class="content">
      <div class="content-inner order-detail-wrapper">

        <!-- üîô BACK BUTTON -->
        <div class="order-back">
          <a href="/my-orders" class="btn-back">
            ‚Üê Quay l·∫°i ƒë∆°n h√†ng c·ªßa t√¥i
          </a>
        </div>

        <% if (!order) { %>
          <div class="empty-text">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng</div>
        <% } else { %>

          <!-- ===== ORDER SUMMARY ===== -->
          <div class="order-summary">
            <h2>ƒê∆°n h√†ng #<%= order.orderId %></h2>

            <div class="order-meta">
              <div>
                <span class="label">Tr·∫°ng th√°i</span>
                <span class="status-badge status-<%= order.status.toLowerCase() %>">
                  <%= order.status %>
                </span>
              </div>

              <div>
                <span class="label">Ng√†y ƒë·∫∑t</span>
                <span>
                  <%= new Date(order.createdAt).toLocaleString("vi-VN") %>
                </span>
              </div>

              <div>
                <span class="label">T·ªïng ti·ªÅn</span>
                <span class="price">
                  <%= order.totalAmount.toLocaleString("vi-VN") %> ƒë
                </span>
              </div>
            </div>
          </div>

          <!-- ===== ITEMS ===== -->
          <h3 class="section-title">S·∫£n ph·∫©m trong ƒë∆°n</h3>

          <table class="order-items-table">
            <thead>
              <tr>
                <th>S·∫£n ph·∫©m</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>ƒê∆°n gi√°</th>
                <th>Th√†nh ti·ªÅn</th>
              </tr>
            </thead>
            <tbody>
              <% order.items.forEach(i => { %>
                <tr>
                  <td class="product-name"><%= i.productName %></td>
                  <td><%= i.quantity %></td>
                  <td><%= i.unitPrice.toLocaleString("vi-VN") %> ƒë</td>
                  <td class="price">
                    <%= i.totalPrice.toLocaleString("vi-VN") %> ƒë
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <!-- ===== FEEDBACK (COMPLETED ORDERS) ===== -->
          <% if (order.status === "COMPLETED") { %>
            <h3 class="section-title">ƒê√°nh gi√° ƒë∆°n h√†ng</h3>
            <form method="post" action="/orders/<%= order.orderId %>/feedback">
              <textarea name="content" required placeholder="Nh·∫≠p ƒë√°nh gi√° c·ªßa b·∫°n..."></textarea>
              <button class="btn-primary" type="submit">
                G·ª≠i ƒë√°nh gi√°
              </button>
            </form>
          <% } %>

        <% } %>

      </div>
    </main>

    <%- include("partials/footer") %>
  </div>
</div>

<script src="/js/layout.js"></script>
</body>
</html>
